1．Web アプリを作るために必要なもの（具体）
技術・アカウント

Vercel プロジェクト（Next.js 14 / App Router / TypeScript）
例えると：Vercel は「屋台の出店場所」、Server Actions は「必要なときだけ開ける仮設厨房」。

Google Cloud プロジェクト（Slides API・Drive API 有効化）

サービスアカウント作成 → テンプレスライドを閲覧・編集可能に共有

必要スコープ：https://www.googleapis.com/auth/presentations、https://www.googleapis.com/auth/drive
身近な例：サービスアカウント＝「現場に入れる作業員用の通行証」

Google スライドのテンプレ（PDF と同デザインのマスター/レイアウト）

スライド ID（PRESENTATION_ID）を環境変数で管理

環境変数（Vercel の Encrypted Env）

GOOGLE_CLIENT_EMAIL / GOOGLE_PRIVATE_KEY（サービスアカウント）

TEMPLATE_PRESENTATION_ID, 生成先フォルダの DRIVE_FOLDER_ID など

データ運用まわり

入力 CSV：

A）日次・週次集計の元データ（期間、表示、CTR、ASR、完了率、応募数、費用…）

B）当月のブランド/キャンペーン別集計（求人数、表示、CTR、ASR、応募数、費用、CPA…）

列名ゆれに対応するマッピング機能（初回設定を保存）

正規化ルール：日付・数値型、ゼロ割回避、桁区切り（¥）、%は小数点 2 桁

アクセス制御：Basic 認証 or NextAuth（Google）

ログ/履歴（任意）：Vercel KV / Postgres / Supabase に「月」「案件」キーで PDF を一覧化

完成イメージ（PDF 準拠のテンプレ構成）

3P：KPI カード（総表示・総応募・平均 CPA）＋月次表＋前月差のコメント

4P：週別表＋週次推移コメント（3/1–3/7 等の並び）

5P：ブランド（キャンペーン）別表＋ポイント（TOP N、ゼロ応募検出）

6–7P：課題と施策案（箇条書き）

8P：予算シミュレーション表＋推奨プラン（例：プラン 2=30%増額）

9P：まとめ/KPI 目標（応募完了率 80%など）

2．データの流れ → スライド生成まで（ETL→ 差し込み）
身近な例で言うと、材料を受け取る → 下ごしらえ → 盛り付け → 配膳の順です。

① 取り込み（E：Extract）

画面で CSV A/B をアップロード → 列名マッピング（必須列チェック）

週の定義：当面は 1–7 / 8–14 / 15–21 / 22–月末（PDF の 3 月週区切りと同等の見え方）に固定。

② 前処理（T：Transform）

型変換、欠損穴埋め、正規化（%を 0–1 に、¥ を数値に）

派生指標（入力欠けを補完）

クリック数 = 表示 ×CTR

応募開始数 = クリック数 ×ASR

応募完了率 = 応募数 / 応募開始数（0 除算は“–”）

応募率(AR) = 応募数 / クリック数

CPA = 費用 / 応募数（応募 0 なら“–”）

集計

月次：1 月/2 月/3 月…の行＋前月比の差分列（緑/赤の色付け） → 3P の表に対応。

週次：各週の行を生成（3/1–3/7 など） → 4P の表に対応。

ブランド/キャンペーン別：当月のみ集計、TOP N ＋その他を算出 → 5P の表に対応。

③ コメント生成（ルールベース）

前月比/週次トレンド/ブランド別の重要差をしきい値で検出して短文化（後述）

④ 予算シミュレーション

仮定（編集可）：CTR・ASR・完了率は改善施策で一定幅向上／費用はプラン倍率

計算：
費用 → クリック数（費用 ÷CPC 想定）→ 応募開始（×ASR）→ 応募数（× 完了率）→CPA（費用/応募数）

「現状・プラン 1・プラン 2（+30%）・プラン 3（+50%）」の表を整形（8P 相当）。

⑤ スライド生成（L：Load）

テンプレを Drive の files.copy で複製 →batchUpdate で差し込み →Drive の**files.export(PDF)で出力
身近な例：batchUpdate は「店員さんにまとめて**オーダー伝票を渡す」操作。

⑥ 配布

生成した Slides URL と PDF ダウンロードをアプリで提示

任意で履歴保存（案件名＋年月で紐付け）

3．「考察」コメントの観点・ルール（テンプレ化）
PDF のトーンは短い結論＋理由、数値は**前月比や最大小最小の“差”**を強調。

（用語の身近な例：ボトルネック＝「一番遅いレジが列全体の流れを止める」）

A. 月次サマリー（3P の“前月比較分析”に倣う）

基本型：「○○ は △△ だが □□ が改善（or 悪化）」→ トレードオフを 1 行で要約

例：表示回数 ↓ だが応募開始率 ↑/完了率 ↑ → CPA↓ を検出したら
→「表示は減少したが効率が大幅改善：質の高い露出に成功」などを自動生成。

閾値例：±5%＝小幅、±10%＝中、±20%＝大（強調色・矢印を切替）

B. 週次（4P の“週次推移分析”に倣う）

週ごとの最高/最低（応募単価のベスト週等）と傾向（右肩上がり/下がり）

例：「中旬以降の ASR/完了率改善」「最終週の CTR 回復」などの定型句に数値を流し込み。

C. ブランド/キャンペーン別（5P の“分析ポイント”に倣う）

高効率（低 CPA・高 AR/ASR）／低効率（高 CPA・ゼロ応募）／費用は大だが成果弱を自動ラベル

成功事例の横展開提案（訴求・求人設計・画像・原稿構成）を 1 行追加。

D. 課題・施策（6–7P）

格差の明示（最大 CPA/最小 CPA の倍率、ゼロ応募の検出）→ 改善方向性（原稿最適化、フロー短縮、予算再配分）を雛形文で出力。

E. 予算シミュレーション（8P）

プラン別の応募数増加率・CPA 低下率を一目で。

推奨プランを自動選定（最大応募数/最良 CPA/バランス型のいずれかルール）
例：30%増額＋施策で“応募数 100%増・CPA35%減”のような表現を生成。

F. まとめ（9P）

KPI 目標（完了率 ≥80%、CPA≤¥15,000、応募率 ≥1.5%、月間応募数 ≥12 など）を自動反映。

4．スライド生成の方法（Google Slides API での実装詳細） 0) テンプレ設計（Google スライド側）

マスターに各ページのレイアウトを作成（3P〜9P）。

差し込み用にテキストのプレースホルダを置く（例）

KPI カード：{{total_impressions}}, {{total_applies}}, {{avg_cpa}}, {{mom_impressions}}, {{mom_applies}}, {{mom_cpa}}（3P）

月次表：{{monthly_table}}（テーブル自体はコードで生成/差し替え）

週次表：{{weekly_table}}（4P）

ブランド表：{{brand_table}}（5P）

コメント：{{monthly_insights}}, {{weekly_insights}}, {{brand_insights}}（箇条書き）

課題・施策：{{issues_list}}, {{actions_list}}（6–7P）

予算：{{budget_table}}, {{recommended_plan}}（8P）

まとめ：{{summary_points}}（9P）

色とフォントはテンプレ側で固定（Noto Sans JP / ルビ無し）

1. テンプレの複製

Drive API files.copy でテンプレを複製 → 新しい presentationId 取得
身近な例：雛形をコンビニでコピーしてから書き込むイメージ。

2. 差し込み（Slides API batchUpdate）

テキスト置換：ReplaceAllTextRequest で{{xxx}}を一括置換（数字はあらかじめ整形）

テーブル生成/入れ替え（可変行対策）：

CreateTable で行 × 列を生成 → 各セルに InsertText

行が多い場合は TOP N ＋その他に集約

セル装飾：UpdateTableCellProperties で背景色（良化=緑/悪化=赤）、UpdateTextStyle で強調

行の可変が少ないページ（例：週次 4–5 行）は、テンプレに最大行で空行を用意 → 余分は内容クリアでも OK。

数値フォーマット：

金額：¥ ＋ 3 桁区切り、%：小数点 2 桁、0 割は–表記

前月比：+7.1%などの符号付き（色付け）—3P/4P の見た目を踏襲。

3. PDF 出力

Drive API files.export (application/pdf)で PDF 化 → アプリからダウンロードリンクを返す
（身近な例：完成したスライドを「PDF プリント」する操作を自動でやる）

4. 失敗時のフォールバック

Rate limit 時はリトライ＋ジョブキュー（“整理券”方式）

万一テーブル生成に失敗した場合は、テキストのみ差し替えて再実行できるように段階化

5. QA 基準（受け入れ条件）

同一 CSV→ 同一 PDF（値・色・順序が一致）

3P〜9P の要素が全て埋まる（欠損時は–）—特に「前月比」「週の区切り」「ゼロ応募の赤字強調」を確認。
